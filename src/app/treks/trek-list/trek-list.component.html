<ion-content>
  <div class="container-fluid py-3">
    <ion-header>
      <ion-toolbar color="primary">
        <ion-buttons slot="start">
          <ion-back-button defaultHref="/dashboard"></ion-back-button>
        </ion-buttons>
        <ion-title>All Treks</ion-title>
      </ion-toolbar>

      <ion-toolbar>
        <ion-searchbar
          [(ngModel)]="searchQuery"
          placeholder="Search treks..."
          animated="true"
        >
        </ion-searchbar>
      </ion-toolbar>
    </ion-header>

    <!-- Summary -->
    <div class="row text-center mb-3 mt-3">
      <div class="col">
        <div class="card">
          <div class="card-body">
            <h3>{{ treks.length }}</h3>
            <p class="text-muted mb-0">Total Treks</p>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <div class="card-body">
            <h3>{{ activeCount }}</h3>
            <p class="text-muted mb-0">Active Batches</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Treks List -->
    <div class="row">
      <div class="col-md-4 mb-4" *ngFor="let trek of filteredTreks">
        <div class="card h-100 trek-card">
          <!-- Image -->
          <div class="position-relative">
            <img
              class="card-img-top"
              [src]="'http://localhost:4001/' + trek.cover_image"
            />
            <span
              class="badge position-absolute top-0 end-0 m-2"
              [ngClass]="{
                'bg-success': trek.status === 'active',
                'bg-secondary': trek.status === 'draft',
              }"
            >
              {{ trek.status | uppercase }}
            </span>
          </div>

          <!-- Content -->
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <h6 class="mb-0 fw-semibold text-truncate">
                {{ trek.name }}
              </h6>

              <button
                class="btn btn-sm btn-light border-0 edit-btn"
                (click)="editTrek(trek.id)"
                aria-label="Edit trek"
              >
                <span class="emoji">‚úèÔ∏è</span>
              </button>
            </div>

            <p class="text-muted mb-1">üìç {{ trek.location }}</p>

            <div *ngIf="trek?.batches?.length">
              <span
                *ngFor="let batch of trek.batches"
                class="badge bg-primary rounded-pill me-1 small-badge"
                (click)="viewTrek(batch.id)"
              >
                ‚è± {{ batch.duration }} ¬∑ ‚Çπ{{ batch.price }} /
                {{ batch.startDate | date: "dd MMM yyyy" }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredTreks.length === 0" class="text-center py-5">
      <h5>No treks found</h5>
      <p class="text-muted">Try a different search</p>
    </div>
  </div>
</ion-content>
